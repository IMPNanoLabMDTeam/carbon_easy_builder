# 更新日志 (Changelog)

本文档记录了 Carbon Easy Builder 项目的重要更新和bug修复。

## [v0.1.1] - 2024-12-19

### 重要Bug修复 🐛

#### CNT原子数量错误问题修复

**问题描述：**
- **影响范围：** `CarbonNanotube` 类生成的所有Armchair型CNT
- **问题表现：** (n,n) CNT一个周期生成的原子数超过理论值4×n个
- **具体案例：** (6,6) CNT一个周期生成30个原子，而理论值应为24个

**根本原因：**
周期性边界条件处理存在bug。当原子的z坐标经过 `z % Ltot` 包裹后非常接近 `Ltot` 时，这些原子实际上应该与 z≈0 的原子重合（因为周期性边界条件），但原来的代码没有正确处理这种边界情况，导致：
- 生成了额外的第三层原子
- 这些多余原子位于 z≈Ltot 位置
- 在周期性系统中，它们实际上是第一层原子的镜像

**技术分析：**
```python
# 修复前的问题代码段
z_wrapped = z % Ltot  # 仅做模运算，未处理边界情况
key = (round(x, 5), round(y, 5), round(z_wrapped, 5))

# 问题：当 z_wrapped ≈ Ltot 时，这些原子应该映射到 z ≈ 0
```

**修复方案：**
在 `nanotube.py` 的第49-53行添加了边界条件处理：
```python
# 处理周期性边界条件：如果z_wrapped非常接近Ltot，将其映射到0
if abs(z_wrapped - Ltot) < 1e-3:
    z_wrapped = 0.0
```

**修复验证：**
修复后各种CNT的原子数完全符合理论预期：
- (6,6) CNT: 24个原子 = 4×6 ✓
- (7,7) CNT: 28个原子 = 4×7 ✓  
- (8,8) CNT: 32个原子 = 4×8 ✓
- (9,9) CNT: 36个原子 = 4×9 ✓
- (10,10) CNT: 40个原子 = 4×10 ✓
- (11,11) CNT: 44个原子 = 4×11 ✓
- (12,12) CNT: 48个原子 = 4×12 ✓

**影响评估：**
- ✅ **向后兼容：** 现有代码无需修改
- ✅ **数据一致性：** 生成的结构现在完全正确
- ✅ **物理正确性：** 周期性边界条件处理正确
- ⚠️  **注意：** 之前使用旧版本生成的CNT结构可能包含多余原子，建议重新生成

**相关文件：**
- `carbon_easy_builder/nanotube.py` - 核心修复代码
- `tests/test_nanotube.py` - 相关测试（需要更新）

---

## 如何报告Bug

如果您发现了类似的问题，请通过以下方式报告：

1. **GitHub Issues：** 在项目仓库创建issue
2. **包含信息：**
   - 使用的版本
   - 重现步骤
   - 期望结果 vs 实际结果
   - 系统环境信息

3. **最佳实践：**
   - 提供最小重现代码
   - 包含生成的结构文件
   - 描述物理/化学背景（如适用） 